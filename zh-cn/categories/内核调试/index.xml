<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>内核调试 on Misaka的秘密花园</title><link>https://blog.moeomu.com/zh-cn/categories/%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95/</link><description>Recent content in 内核调试 on Misaka的秘密花园</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Sat, 17 Oct 2020 20:23:00 +0800</lastBuildDate><atom:link href="https://blog.moeomu.com/zh-cn/categories/%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95/index.xml" rel="self" type="application/rss+xml"/><item><title>Windows内核调试学习笔记-002-结构体</title><link>https://blog.moeomu.com/zh-cn/posts/windows%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-002-%E7%BB%93%E6%9E%84%E4%BD%93/</link><pubDate>Sat, 17 Oct 2020 20:23:00 +0800</pubDate><guid>https://blog.moeomu.com/zh-cn/posts/windows%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-002-%E7%BB%93%E6%9E%84%E4%BD%93/</guid><description>&lt;p>本文来源：&lt;a class="link" href="https://blog.moeomu.com/zh-cn/posts/windows%e5%86%85%e6%a0%b8%e8%b0%83%e8%af%95%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0-002-%e7%bb%93%e6%9e%84%e4%bd%93/" >Moeomu的博客&lt;/a>&lt;/p>
&lt;h2 id="非公开内核结构">非公开内核结构&lt;/h2>
&lt;p>Windows的非公开结构非常多，而有些结构是半公开的，虽然有字段名，但只能推测其用意&lt;br>
WinDbg能加载一些内核调试符号，在这些PDB文件中，有一些半公开结构的信息&lt;/p>
&lt;hr>
&lt;h2 id="eprocesskpebkernel-process-environment-block">EPROCESS(KPEB)(Kernel Process Environment Block)&lt;/h2>
&lt;p>每一个进程都由一个EPROCESS结构表示，而这些结构被一个双向链表所连接&lt;/p>
&lt;h3 id="结构信息">结构信息&lt;/h3>
&lt;ul>
&lt;li>0x000偏移是PCB(Process Control Block)的地址，它位于R0中&lt;/li>
&lt;li>0x0b4偏移是PID，它是标识此进程的唯一标识符&lt;/li>
&lt;li>0x0b8偏移是活动进程链表，可以用它遍历系统的所有EPROCESS结构&lt;/li>
&lt;/ul>
&lt;h3 id="结构组成">结构组成&lt;/h3>
&lt;blockquote>
&lt;p>以下是此结构的详细内容&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">kd&amp;gt; dt _eprocess
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nt!_EPROCESS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x000 Pcb : _KPROCESS // 进程控制块
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x098 ProcessLock : _EX_PUSH_LOCK // 进程锁
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0a0 CreateTime : _LARGE_INTEGER // 创建时间
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0a8 ExitTime : _LARGE_INTEGER // 退出时间
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0b0 RundownProtect : _EX_RUNDOWN_REF // 进程加保护
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0b4 UniqueProcessId : Ptr32 Void // PID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0b8 ActiveProcessLinks : _LIST_ENTRY // 活动进程链表
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0c0 ProcessQuotaUsage : [2] Uint4B // 物理页相关的统计信息
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0c8 ProcessQuotaPeak : [2] Uint4B // 物理页相关的统计信息
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0d0 CommitCharge : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0d4 QuotaBlock : Ptr32 _EPROCESS_QUOTA_BLOCK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0d8 CpuQuotaBlock : Ptr32 _PS_CPU_QUOTA_BLOCK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0dc PeakVirtualSize : Uint4B // 虚拟内存池大小
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0e0 VirtualSize : Uint4B // 虚拟内存大小
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0e4 SessionProcessLinks : _LIST_ENTRY
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0ec DebugPort : Ptr32 Void // 调试端口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0f0 ExceptionPortData : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0f0 ExceptionPortValue : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0f0 ExceptionPortState : Pos 0, 3 Bits
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0f4 ObjectTable : Ptr32 _HANDLE_TABLE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0f8 Token : _EX_FAST_REF // 权限令牌的地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0fc WorkingSetPage : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x100 AddressCreationLock : _EX_PUSH_LOCK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x104 RotateInProgress : Ptr32 _ETHREAD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x108 ForkInProgress : Ptr32 _ETHREAD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x10c HardwareTrigger : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x110 PhysicalVadRoot : Ptr32 _MM_AVL_TABLE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x114 CloneRoot : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x118 NumberOfPrivatePages : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x11c NumberOfLockedPages : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x120 Win32Process : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x124 Job : Ptr32 _EJOB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x128 SectionObject : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x12c SectionBaseAddress : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x130 Cookie : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x134 Spare8 : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x138 WorkingSetWatch : Ptr32 _PAGEFAULT_HISTORY
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x13c Win32WindowStation : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x140 InheritedFromUniqueProcessId : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x144 LdtInformation : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x148 VdmObjects : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x14c ConsoleHostProcess : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x150 DeviceMap : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x154 EtwDataSource : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x158 FreeTebHint : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x160 PageDirectoryPte : _HARDWARE_PTE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x160 Filler : Uint8B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x168 Session : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x16c ImageFileName : [15] UChar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x17b PriorityClass : UChar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x17c JobLinks : _LIST_ENTRY
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x184 LockedPagesList : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x188 ThreadListHead : _LIST_ENTRY // ETHREAD结构链表头
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x190 SecurityPort : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x194 PaeTop : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x198 ActiveThreads : Uint4B // 正在运行的线程数量
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x19c ImagePathHash : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1a0 DefaultHardErrorProcessing : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1a4 LastThreadExitStatus : Int4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1a8 Peb : Ptr32 _PEB // 进程环境块地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1ac PrefetchTrace : _EX_FAST_REF
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1b0 ReadOperationCount : _LARGE_INTEGER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1b8 WriteOperationCount : _LARGE_INTEGER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1c0 OtherOperationCount : _LARGE_INTEGER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1c8 ReadTransferCount : _LARGE_INTEGER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1d0 WriteTransferCount : _LARGE_INTEGER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1d8 OtherTransferCount : _LARGE_INTEGER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1e0 CommitChargeLimit : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1e4 CommitChargePeak : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1e8 AweInfo : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1ec SeAuditProcessCreationInfo : _SE_AUDIT_PROCESS_CREATION_INFO
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1f0 Vm : _MMSUPPORT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x25c MmProcessLinks : _LIST_ENTRY
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x264 HighestUserAddress : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x268 ModifiedPageCount : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c Flags2 : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c JobNotReallyActive : Pos 0, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c AccountingFolded : Pos 1, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c NewProcessReported : Pos 2, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c ExitProcessReported : Pos 3, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c ReportCommitChanges : Pos 4, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c LastReportMemory : Pos 5, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c ReportPhysicalPageChanges : Pos 6, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c HandleTableRundown : Pos 7, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c NeedsHandleRundown : Pos 8, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c RefTraceEnabled : Pos 9, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c NumaAware : Pos 10, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c ProtectedProcess : Pos 11, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c DefaultPagePriority : Pos 12, 3 Bits
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c PrimaryTokenFrozen : Pos 15, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c ProcessVerifierTarget : Pos 16, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c StackRandomizationDisabled : Pos 17, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c AffinityPermanent : Pos 18, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c AffinityUpdateEnable : Pos 19, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c PropagateNode : Pos 20, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x26c ExplicitAffinity : Pos 21, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 Flags : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 CreateReported : Pos 0, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 NoDebugInherit : Pos 1, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 ProcessExiting : Pos 2, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 ProcessDelete : Pos 3, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 Wow64SplitPages : Pos 4, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 VmDeleted : Pos 5, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 OutswapEnabled : Pos 6, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 Outswapped : Pos 7, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 ForkFailed : Pos 8, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 Wow64VaSpace4Gb : Pos 9, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 AddressSpaceInitialized : Pos 10, 2 Bits
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 SetTimerResolution : Pos 12, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 BreakOnTermination : Pos 13, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 DeprioritizeViews : Pos 14, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 WriteWatch : Pos 15, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 ProcessInSession : Pos 16, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 OverrideAddressSpace : Pos 17, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 HasAddressSpace : Pos 18, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 LaunchPrefetched : Pos 19, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 InjectInpageErrors : Pos 20, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 VmTopDown : Pos 21, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 ImageNotifyDone : Pos 22, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 PdeUpdateNeeded : Pos 23, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 VdmAllowed : Pos 24, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 CrossSessionCreate : Pos 25, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 ProcessInserted : Pos 26, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 DefaultIoPriority : Pos 27, 3 Bits
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 ProcessSelfDelete : Pos 30, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x270 SetTimerResolutionLink : Pos 31, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x274 ExitStatus : Int4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x278 VadRoot : _MM_AVL_TABLE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x298 AlpcContext : _ALPC_PROCESS_CONTEXT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x2a8 TimerResolutionLink : _LIST_ENTRY
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x2b0 RequestedTimerResolution : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x2b4 ActiveThreadsHighWatermark : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x2b8 SmallestTimerResolution : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x2bc TimerResolutionStackRecord : Ptr32 _PO_DIAG_STACK_RECORD
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;hr>
&lt;h2 id="pebprocess-environment-block">PEB(Process Environment Block)&lt;/h2>
&lt;p>此结构位于R3层，相对容易修改&lt;/p>
&lt;h3 id="结构信息-1">结构信息&lt;/h3>
&lt;ul>
&lt;li>0x002偏移是是否被调试的FLAG的位置，这个值在R3下即可被修改&lt;/li>
&lt;li>0x068偏移此值平时是0，被调试时是0x70&lt;/li>
&lt;li>0x018偏移是_HEAP结构的地址，此结构体内可以判断在偏移0x40=2和0x44=0时为非调试状态&lt;/li>
&lt;/ul>
&lt;h3 id="结构组成-1">结构组成&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;span class="lnt">86
&lt;/span>&lt;span class="lnt">87
&lt;/span>&lt;span class="lnt">88
&lt;/span>&lt;span class="lnt">89
&lt;/span>&lt;span class="lnt">90
&lt;/span>&lt;span class="lnt">91
&lt;/span>&lt;span class="lnt">92
&lt;/span>&lt;span class="lnt">93
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">kd&amp;gt; dt _PEB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nt!_PEB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x000 InheritedAddressSpace : UChar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x001 ReadImageFileExecOptions : UChar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x002 BeingDebugged : UChar // 是否被调试
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x003 BitField : UChar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x003 ImageUsesLargePages : Pos 0, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x003 IsProtectedProcess : Pos 1, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x003 IsLegacyProcess : Pos 2, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x003 IsImageDynamicallyRelocated : Pos 3, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x003 SkipPatchingUser32Forwarders : Pos 4, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x003 SpareBits : Pos 5, 3 Bits
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x004 Mutant : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x008 ImageBaseAddress : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x00c Ldr : Ptr32 _PEB_LDR_DATA // 进程装载的模块结构体
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x010 ProcessParameters : Ptr32 _RTL_USER_PROCESS_PARAMETERS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x014 SubSystemData : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x018 ProcessHeap : _HEAP // 0x40=2&amp;amp;&amp;amp;0x44=0为非调试状态
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x01c FastPebLock : Ptr32 _RTL_CRITICAL_SECTION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x020 AtlThunkSListPtr : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x024 IFEOKey : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x028 CrossProcessFlags : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x028 ProcessInJob : Pos 0, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x028 ProcessInitializing : Pos 1, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x028 ProcessUsingVEH : Pos 2, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x028 ProcessUsingVCH : Pos 3, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x028 ProcessUsingFTH : Pos 4, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x028 ReservedBits0 : Pos 5, 27 Bits
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x02c KernelCallbackTable : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x02c UserSharedInfoPtr : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x030 SystemReserved : [1] Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x034 AtlThunkSListPtr32 : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x038 ApiSetMap : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x03c TlsExpansionCounter : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x040 TlsBitmap : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x044 TlsBitmapBits : [2] Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x04c ReadOnlySharedMemoryBase : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x050 HotpatchInformation : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x054 ReadOnlyStaticServerData : Ptr32 Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x058 AnsiCodePageData : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x05c OemCodePageData : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x060 UnicodeCaseTableData : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x064 NumberOfProcessors : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x068 NtGlobalFlag : Uint4B // 反调试用
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x070 CriticalSectionTimeout : _LARGE_INTEGER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x078 HeapSegmentReserve : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x07c HeapSegmentCommit : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x080 HeapDeCommitTotalFreeThreshold : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x084 HeapDeCommitFreeBlockThreshold : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x088 NumberOfHeaps : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x08c MaximumNumberOfHeaps : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x090 ProcessHeaps : Ptr32 Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x094 GdiSharedHandleTable : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x098 ProcessStarterHelper : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x09c GdiDCAttributeList : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0a0 LoaderLock : Ptr32 _RTL_CRITICAL_SECTION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0a4 OSMajorVersion : Uint4B // 系统主版本号
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0a8 OSMinorVersion : Uint4B // 系统子版本号
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0ac OSBuildNumber : Uint2B // 系统构建版本号
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0ae OSCSDVersion : Uint2B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0b0 OSPlatformId : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0b4 ImageSubsystem : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0b8 ImageSubsystemMajorVersion : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0bc ImageSubsystemMinorVersion : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0c0 ActiveProcessAffinityMask : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x0c4 GdiHandleBuffer : [34] Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x14c PostProcessInitRoutine : Ptr32 void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x150 TlsExpansionBitmap : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x154 TlsExpansionBitmapBits : [32] Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1d4 SessionId : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1d8 AppCompatFlags : _ULARGE_INTEGER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1e0 AppCompatFlagsUser : _ULARGE_INTEGER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1e8 pShimData : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1ec AppCompatInfo : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1f0 CSDVersion : _UNICODE_STRING
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1f8 ActivationContextData : Ptr32 _ACTIVATION_CONTEXT_DATA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x1fc ProcessAssemblyStorageMap : Ptr32 _ASSEMBLY_STORAGE_MAP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x200 SystemDefaultActivationContextData : Ptr32 _ACTIVATION_CONTEXT_DATA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x204 SystemAssemblyStorageMap : Ptr32 _ASSEMBLY_STORAGE_MAP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x208 MinimumStackCommit : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x20c FlsCallback : Ptr32 _FLS_CALLBACK_INFO
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x210 FlsListHead : _LIST_ENTRY
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x218 FlsBitmap : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x21c FlsBitmapBits : [4] Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x22c FlsHighIndex : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x230 WerRegistrationData : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x234 WerShipAssertPtr : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x238 pContextData : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x23c pImageHeaderHash : Ptr32 Void
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x240 TracingFlags : Uint4B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x240 HeapTracingEnabled : Pos 0, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x240 CritSecTracingEnabled : Pos 1, 1 Bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +0x240 SpareTracingBits : Pos 2, 30 Bits
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;hr>
&lt;h2 id="参考文档">参考文档&lt;/h2>
&lt;p>[1]Infosavvy.Understanding EProcess Structure[J/OL].2020-07-24&lt;/p></description></item><item><title>Windows内核调试学习笔记-001-环境搭建</title><link>https://blog.moeomu.com/zh-cn/posts/windows%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-001-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</link><pubDate>Sat, 17 Oct 2020 19:27:00 +0800</pubDate><guid>https://blog.moeomu.com/zh-cn/posts/windows%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-001-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</guid><description>&lt;p>本文来源：&lt;a class="link" href="https://blog.moeomu.com/zh-cn/posts/windows%e5%86%85%e6%a0%b8%e8%b0%83%e8%af%95%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0-001-%e7%8e%af%e5%a2%83%e6%90%ad%e5%bb%ba/" >Moeomu的博客&lt;/a>&lt;/p>
&lt;h2 id="下载工具">下载工具&lt;/h2>
&lt;ul>
&lt;li>Windows 7 SP1 x86 &lt;a class="link" href="thunder://QUFlZDJrOi8vfGZpbGV8Y25fd2luZG93c183X3VsdGltYXRlX3dpdGhfc3AxX3g4Nl9kdmRfdV82Nzc0ODYuaXNvfDI2NTMyNzYxNjB8NzUwM0U0QjlCODczOERGQ0I5NTg3MjQ0NUM3MkFFRkJ8L1pa" >镜像迅雷下载链接&lt;/a>&lt;/li>
&lt;li>VMWare Workstation 16(链接在下方)&lt;/li>
&lt;li>WinDbg Preview(&lt;a class="link" href="https://www.microsoft.com/zh-cn/p/windbg-preview/9pgjgd53tn86" target="_blank" rel="noopener"
>Microsoft Store&lt;/a>)&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="安装windows虚拟机">安装Windows虚拟机&lt;/h2>
&lt;blockquote>
&lt;p>最初以Windows 7 SP1 x86为例子来学习&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>MSDN下载官方镜像&lt;/li>
&lt;li>VMWare Workstation 16搭建虚拟环境
&lt;ul>
&lt;li>下载：&lt;a class="link" href="https://www.vmware.com/go/getworkstation-win" target="_blank" rel="noopener"
>VMWare 16 Link&lt;/a>&lt;/li>
&lt;li>密钥：&lt;code>ZF3R0-FHED2-M80TY-8QYGC-NPKYF&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="配置windows内核调试虚拟机">配置Windows内核调试虚拟机&lt;/h2>
&lt;h3 id="移除此虚拟机的打印机设备">移除此虚拟机的打印机设备&lt;/h3>
&lt;h3 id="添加串行串口">添加串行串口&lt;/h3>
&lt;ul>
&lt;li>点击使用命名的管道&lt;/li>
&lt;li>填入字符串：&lt;code>\\.\pipe\Windows7x86&lt;/code>(可以填入自己希望的管道命名，但是只能修改&lt;code>Windows7x86&lt;/code>位置处)&lt;/li>
&lt;li>下方选择该端是服务器，另一端是应用程序&lt;/li>
&lt;li>I/O模式中，选择&lt;code>轮询时主动放弃&lt;/code>&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>配置完成如下图所示&lt;/p>
&lt;/blockquote>
&lt;p>&lt;img src="https://blog.moeomu.com/Virtual%20Machine%20Configuration%20Diagram.png.png"
loading="lazy"
alt="虚拟机配置图.png"
>&lt;/p>
&lt;h3 id="配置windows7">配置Windows7&lt;/h3>
&lt;ul>
&lt;li>输入命令&lt;code>msconfig&lt;/code>，点击引导，如图&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.moeomu.com/zh-cn/posts/windows%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-001-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/boot.png"
width="575"
height="358"
srcset="https://blog.moeomu.com/zh-cn/posts/windows%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-001-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/boot_huba423bbd3ab8df1ce0985da4b541cd54_17644_480x0_resize_box_3.png 480w, https://blog.moeomu.com/zh-cn/posts/windows%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-001-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/boot_huba423bbd3ab8df1ce0985da4b541cd54_17644_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="引导.jpg"
class="gallery-image"
data-flex-grow="160"
data-flex-basis="385px"
>&lt;/p>
&lt;ul>
&lt;li>点击高级选项，启用调试，波特率，如图&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://blog.moeomu.com/zh-cn/posts/windows%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-001-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/advanced-options.png"
width="385"
height="359"
srcset="https://blog.moeomu.com/zh-cn/posts/windows%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-001-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/advanced-options_hu981ad8955097328f8e19a335eb08f34c_12081_480x0_resize_box_3.png 480w, https://blog.moeomu.com/zh-cn/posts/windows%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-001-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/advanced-options_hu981ad8955097328f8e19a335eb08f34c_12081_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="高级选项.jpg"
class="gallery-image"
data-flex-grow="107"
data-flex-basis="257px"
>&lt;/p>
&lt;hr>
&lt;h2 id="配置windbg-preview">配置WinDbg Preview&lt;/h2>
&lt;ul>
&lt;li>首先启动代理网络，用于解除GFW限制&lt;/li>
&lt;li>设置WinDbg的符号服务器和本地缓存目录&lt;code>SRV*D:\LocalSymbols*http://msdl.microsoft.com/download/symbols&lt;/code>&lt;/li>
&lt;li>Attach to kernel-COM-能选的对勾都选上-填波特率-Port填&lt;code>\\.\pipe\Windows7x86&lt;/code>&lt;/li>
&lt;li>点击OK以调试虚拟机内核&lt;/li>
&lt;li>设置WinDbg的符号服务器代理&lt;code>set _NT_SYMBOL_PROXY=代理服务器地址:端口号&lt;/code>&lt;/li>
&lt;/ul></description></item></channel></rss>